### 定义

`ICMP` 经常被认为是一个 `IP` 层的组成一个部分。它传递差错报文以及其他需要注意的信息。

一些 `ICMP` 报文把差错报文返回给用户进程

**ICMP 报文是在 IP 数据报内部传输**

---

### 四种常见的 ICMP 差错报告报文

+ 终点不可达

  + 路由器不知道如何转发某种数据报，丢弃该数据报，并向源站发生 “终点不可达” 报文
  + 主机收到无法交付给应用进程的数据报，将其丢弃，向源站发生 “终点不可达” 报文

+ 时间超时

  + 路由器丢弃生存时间 `TTL` 为 0 的数据报，并向源站发送 “时间超过” 报文
  + 当终点在预定规定的时间内不能收到一个数据报的全部分片时，就把已收到的分片都丢弃，并向源站发送 “时间超过” 报文

+ 参数问题

  当路由器或目的主机收到的数据报的首部中有些字段的值不正确时，就丢弃该数据报，并向源站发送 “参数问题” 报文

+ 改变路由

  路由器把 “改变路由” 报文发送给主机，让主机知道下次应将数据报发生给另一个路由器，这样可以通过更好的路由

---

### 两种 ICMP 询问报文                                                                                             

+ 回送请求和回答

  测试目的站是否可达以及了解其有关状态

+ 时间戳请求和回答

  用于时钟同步和时间测量

### 不会产生 ICMP 差错报文的情况

1. `ICMP` 差错报文（但是，`ICMP` 查询报文可能会产生 `ICMP` 差错报文）
2. 目的地址是广播地址或多播地址的 `IP` 数据报
3. 作为链路层广播的数据报
4. 不是 `IP` 分片的第一片
5. 能为零地址、环路地址、广播地址或多播地址

---

